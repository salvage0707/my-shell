#!/bin/bash

# 参考リンク

# インポート
source $MY_SHELL_ROOT_PATH/setting/import
import git/get_projects
import git/current_branch
import print_text

# =======================================================
#【 選択形式のセレクトメニュー】
# 
#   @return なし
# 
# [説明]
#   直下ディレクトリのGitプロジェクトを最新に更新
#
# [使い方]
#   ```
#   read_select_num_res 0 100
#   ```
# =======================================================


info "ブランチを作成します"
info "対象プロジェクト一覧"
get_projects
echo ${get_projects_res[@]}

# 変数
target_projects=()
current_branches=()

# プレフィックス
printf "コメント  : "
read comment

for project in ${get_projects_res[@]}; do
	info $project

	# 入力受付
	printf "コミットしますか? (y/n): "
	read do_commit
	
	case $do_commit in
        "y") ;;

        "exit")
            error "処理を終了しました"
            exit
            ;;

        * ) 
            echo "更新なし"
            continue
            ;;
    esac

    cd $project
    current_branch
    branch=$current_branch_res
    cd ..
    
    # 最新化
    target_projects=("${target_projects[@]}" $project)
    current_branches=("${current_branches[@]}" $branch)
done

# 最終確認
red "最新化しますか? (y/n): "
echo $target_projects
echo $current_branches
read tmp
if [ $tmp != "y" ]; then
	error "処理を終了しました"
	exit
fi

# 最新化
array_last_num=`expr ${#target_projects[@]} - 1`
for index in $(seq 0 ${array_last_num}); do

    p=${target_projects[index]}
    branch=${current_branches[index]}
    echo $issue_num
    issue_num=${branch/"issues/"//}
    echo $issue_num
    issue_num=${issue_num/"_*"//}
    echo $issue_num
    exit

    info "-----------------------------------------"
    echo "プロジェクト  : "$p
    echo "ベースブランチ: "$b
    echo "コメント    : "$comment
    
    git -C $p checkout $b
    git -C $p pull origin $b
    git -C $p checkout -b $prefix$i$sufix

    new_line
done
